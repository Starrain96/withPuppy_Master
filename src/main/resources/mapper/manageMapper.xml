<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="manage">

	<delete id="delete"  parameterType="Int">
		delete from product 
		where product_id = #{product_id}
	</delete>
	
	<select id="all" resultType="productVO">
		select * from product
	</select>
	
	<select id="search" parameterType="productVO" resultType="productVO">
		select  * from product where product_name like #{product_name}
	</select>
	
	<select id="allCnt" resultType="Int">
		select count(product_id) from product 
	</select>
	
	<select id="allCatePage" parameterType="categoryVO" resultType="productVO">
		select * from (
		select row_number() over(order by product_id) as p_no, p.* from product p 
		) p2
		where p_no between #{start_num} and #{end_num}
	</select>
	
	<select id="cateS" resultType="statisticsVO">
		SELECT bc.categoryName AS s_name, SUM(p2.mult) AS s_num
		FROM big_category bc, category c, 
    	(SELECT category2 AS categoryNum, (od.ordered_cnt * p.product_price) AS mult 
     		FROM order_detail od, product p 
     		WHERE od.product_id = p.product_id) AS p2
		WHERE bc.categoryNum = c.bigCategoryNum AND c.categoryNum = p2.categoryNum
		GROUP BY s_name
		ORDER BY s_name ASC
	</select>
	
	
	<!-- 원래는 파라미터로 user_id가져와야함 -->
	<!-- <select id="allProduct" parameterType="String" resultType="productVO">
		select p.product_id, c.cart_id, product_name, product_price, detail, product_img, c.product_cnt 
		from product p left join cart c 
		on(p.product_id = c.product_id) where c.user_id = #{user_id} order by p.product_id
	</select>
	
	<select id="emptyCheck" parameterType="cartVO" resultType="Int"> 
		select count(product_id) from cart 
		where user_id = #{user_id} and product_id = #{product_id} 
	</select> -->

</mapper>